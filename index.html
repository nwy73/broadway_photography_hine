<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>Broadway Vector Tiles</title>
  <link href="https://unpkg.com/maplibre-gl@^5.6.2/dist/maplibre-gl.css" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Jacques+Francois&display=swap" rel="stylesheet">
  <style>
    body,
    html {
      margin: 0;
      padding: 0;
      height: 100%;
    }

    #map-container {
      position: absolute;
      top: 0;
      bottom: 0;
      width: 100%;
      height: 100%;
      overflow: hidden;
    }

    #map {
      position: absolute;
      top: 0;
      bottom: 0;
      width: 100%;
      z-index: 0;
    }

    #opacity-slider {
      font-family: 'Jacques Francois', serif;
      background-color: #f9f7f1;
      border: 1px solid #ccc;
      padding: 12px;
      width: 220px;
      box-shadow: 2px 2px 6px rgba(0, 0, 0, 0.1);
      border-radius: 6px;
      position: absolute;
      top: 10px;
      right: 10px;
      z-index: 2;
    }
  </style>
</head>

<body>
  <div id="map-container">
    <div id="map"></div>
  </div>

  <div id="opacity-slider">
    <label for="slider">Layer Opacity: <span id="opacity-value">100%</span></label>
    <input type="range" id="slider" min="0" max="100" value="100" />
  </div>

  <script src="https://unpkg.com/maplibre-gl@^5.6.2/dist/maplibre-gl.js"></script>
  <script>
    const map = new maplibregl.Map({
      container: 'map',
      style: 'assets/styles/style.json',
      center: [-73.96, 40.785],
      zoom: 11
    });

    map.addControl(new maplibregl.NavigationControl(), 'top-left');

    map.on('load', () => {

map.addSource('voyager', {
  type: 'raster',
  tiles: [
    'https://basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}.png'
  ],
  tileSize: 256
});

map.addLayer({
  id: 'voyager-raster-layer',
  type: 'raster',
  source: 'voyager',
  paint: {
    'raster-opacity': 0  // start fully transparent
  }
}, 'paper-fibers-layer');  // insert under paper-fibers-layer or wherever you want in the stack

      const slider = document.getElementById("slider");
      const opacityValueLabel = document.getElementById("opacity-value");

      const originalOpacities = {};
      map.getStyle().layers.forEach(layer => {
        const {
          id,
          source,
          type
        } = layer;

        if (source === 'broadway') {
          const props = {};
          if (type === 'fill') {
            const opacity = map.getPaintProperty(id, 'fill-opacity');
            props['fill-opacity'] = opacity !== undefined ? opacity : 1;
          } else if (type === 'line') {
            const opacity = map.getPaintProperty(id, 'line-opacity');
            props['line-opacity'] = opacity !== undefined ? opacity : 1;
          } else if (type === 'symbol') {
            const textOpacity = map.getPaintProperty(id, 'text-opacity');
            const iconOpacity = map.getPaintProperty(id, 'icon-opacity');

            props['text-opacity'] = textOpacity !== undefined ? textOpacity : 1;
            props['icon-opacity'] = iconOpacity !== undefined ? iconOpacity : 1;
          }

          if (Object.keys(props).length) {
            originalOpacities[id] = props;
          }
        }

        // Handle the paper raster layer:
        if (id === 'paper-fibers-layer' && type === 'raster') {
          const rasterOpacity = map.getPaintProperty(id, 'raster-opacity');
          originalOpacities[id] = {
            'raster-opacity': rasterOpacity !== undefined ? rasterOpacity : 1
          };
        }
      });

slider.addEventListener("input", () => {
  const value = slider.value;
  const multiplier = value / 100;
  opacityValueLabel.textContent = `${value}%`;

  // Update other layers opacity
  Object.entries(originalOpacities).forEach(([layerId, props]) => {
    // Skip Voyager layer here if you add it to originalOpacities
    if (layerId === 'voyager-raster-layer') return;

    Object.entries(props).forEach(([property, originalValue]) => {
      map.setPaintProperty(layerId, property, originalValue * multiplier);
    });
  });

  // Set Voyager opacity inversely
  const voyagerOpacity = 1 - multiplier;
  if (map.getLayer('voyager-raster-layer')) {
    map.setPaintProperty('voyager-raster-layer', 'raster-opacity', voyagerOpacity);
  }
});

    });
  </script>
</body>

</html>